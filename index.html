<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>FeedUrProf</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<main>

<div class="header-inner"> 
      <div class="brand">FeedUrProf</div> 
</div>

<div class="content"> 

<h2>My questions</h2>


<div class="questions"> 
<div id="questionList"></div>
</div>

</div>

<button class="buttons" onclick="addQuestion()">Add+</button>

<button class="back-button" onclick="window.location.href='MyCourses.html'">Back</button>

</main>

<footer>
    FeedUrProf Â©
</footer>

<h1 id="class-title"></h1>

<img src="edit-icon.png" alt="Edit title" id="edit-icon" class="edit-title" onclick="titleEdit()">

<img src="save-icon.png" alt="Save title" id="save-icon" class="save-title" onclick="titleSave()">


  <script>

  const titleEl = document.getElementById("class-title");
  const editIcon = document.getElementById("edit-icon");
  const saveIcon = document.getElementById("save-icon");
  
  const title = localStorage.getItem("selectedClassTitle");
  if (title) {
    titleEl.textContent = title;
   }


  function titleEdit() {
    titleEl.contentEditable = "true";
    titleEl.focus();

    editIcon.style.display = "none";
    saveIcon.style.display = "inline";
  }

  function titleSave() {
    titleEl.contentEditable = "false";
    const newTitle = titleEl.textContent.trim() || "Untitled class";

    const index = Number(localStorage.getItem("editingClassIndex"));
    const classBars = JSON.parse(localStorage.getItem("classBars")) || [];

    if (!Number.isNaN(index) && index >= 0 && index < classBars.length) {
        const oldTitle = classBars[index]; // current title before rename
        classBars[index] = newTitle;       // update classBars
        localStorage.setItem("classBars", JSON.stringify(classBars));

        // --- MOVE OLD QUESTIONS TO NEW TITLE ---
        let allClasses = JSON.parse(localStorage.getItem("classQuestions")) || {};
        if (allClasses[oldTitle]) {
            allClasses[newTitle] = allClasses[oldTitle]; // move old questions
            delete allClasses[oldTitle];                 // remove old key
            localStorage.setItem("classQuestions", JSON.stringify(allClasses));
        }
    }

    // Update selectedClassTitle for the edit page
    localStorage.setItem("selectedClassTitle", newTitle);

    saveIcon.style.display = "none";
    editIcon.style.display = "inline";
}

function render() {
const className = localStorage.getItem("selectedClassTitle");
const allClasses = JSON.parse(localStorage.getItem("classQuestions")) || {};
const questions = allClasses[className] || [];

const list = document.getElementById("questionList");
list.innerHTML = "";

questions.forEach((q, idx) => {
    const box = document.createElement("div");
    box.className = "question-box";

    box.innerHTML = `
        <p><strong>Q.</strong> ${q.q}</p>
        <p>A1. ${q.a1}</p>
        <p>A2. ${q.a2}</p>
        <p>A3. ${q.a3}</p>
        <img src="edit-icon.png" alt="Edit Q" class="edit" onclick="editQuestion(${idx})">
        <img src="remove-icon.png" alt="Remove Q" class="delete" onclick="deleteQuestion(${idx})">
    `;

    list.appendChild(box);
});
}

function addQuestion() {
    window.location.href = "add.html";
}

function editQuestion(index) {
    localStorage.setItem("currentQuestion", index);
    window.location.href = "questions.html";
}

function deleteQuestion(index) {
    const className = localStorage.getItem("selectedClassTitle");
    const allClasses = JSON.parse(localStorage.getItem("classQuestions")) || {};
    const questions = allClasses[className] || [];

    questions.splice(index, 1);
    allClasses[className] = questions;
    localStorage.setItem("classQuestions", JSON.stringify(allClasses));
    render();
}

render();
</script>

</body>
</html>